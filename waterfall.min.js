(function(){var $container, colW, colNum, colHeightArr; function getMinIndex(arr){var minHeight=Math.min.apply(null,arr);for(var i=0;i<arr.length;i++){if(arr[i]==minHeight){return i;};};} 
function getMaxIndex(arr){var maxHeight=Math.max.apply(null,arr);for(var i=0;i<arr.length;i++){if(arr[i]==maxHeight){return i;};};} 
function fillArr(arr,x){for(var i=0;i<arr.length;i++){arr[i]=x;};} 
var isFirst=true;var put=function(itemEl,isNew){var $item=$(itemEl);var isNew=isNew===undefined?true:false; function add(){ if(isFirst){$container.append($item);colW=$item.width();colNum=parseInt($container.width()/colW+0.2);console.log(colW,colNum)
colHeightArr.length=colNum;fillArr(colHeightArr,0);isFirst=false;} 
var minColIndex=getMinIndex(colHeightArr); var x=minColIndex/colNum*100+'%';var y=colHeightArr[minColIndex];$item.css({position:'absolute',left:x,top:y}); isNew&&$container.append($item); colHeightArr[minColIndex]+=$item.height(); $container.height(Math.max.apply(null,colHeightArr));}; var $img=$item.find('img'); if(isNew&&$img.length){ $img[0].onload=add;}else{ add();};}; var reset=function(){var $items=$container.children(); colW=$items.width();colNum=parseInt($container.width()/colW+0.2); console.log($container.width()/colW,$container.width()/colW+0.2,colNum)
colHeightArr.length=colNum;fillArr(colHeightArr,0);for(var i=0;i<$items.length;i++){ put($items[i],false);}};var resizeTimer;$(window).resize(function(){clearTimeout(resizeTimer);resizeTimer=setTimeout(reset,1001);}); var init=function(ctn){ $container=ctn; colW=null; colNum=1; colHeightArr=[]; var $items=$container.children().clone();$container.empty(); for(var i=0;i<$items.length;i++){put($items[i]);}}; $.fn.waterfall=function(){ init($(this)); 
return{reset:reset,put:put};};})();